<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BiDimensionalMap.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gis.git</a> &gt; <a href="index.source.html" class="el_package">xgis</a> &gt; <span class="el_source">BiDimensionalMap.java</span></div><h1>BiDimensionalMap.java</h1><pre class="source lang-java linenums">package xgis;

import java.math.BigDecimal;
import java.util.*;
import java.util.function.Predicate;
import java.util.function.Supplier;

/**
 * @param &lt;T&gt; generic object to be stored in the collection.
 * @author Vinayak Mathur vxm167
 */
public final class BiDimensionalMap&lt;T&gt; {

<span class="pc" id="L14">	private final SortedMap&lt;BigDecimal, SortedMap&lt;BigDecimal, Collection&lt;T&gt;&gt;&gt; points = new TreeMap&lt;&gt;();</span>

<span class="nc" id="L16">	BiDimensionalMap(Collection&lt;BigDecimal&gt; xCoord, Collection&lt;BigDecimal&gt; yCoord) {</span>
<span class="nc" id="L17">		Objects.requireNonNull(xCoord, &quot;xCoord cannot be null&quot;);</span>
<span class="nc" id="L18">		Objects.requireNonNull(yCoord, &quot;yCoord cannot be null&quot;);</span>
<span class="nc" id="L19">		Updater up = new Updater();</span>
<span class="nc bnc" id="L20" title="All 2 branches missed.">		for (BigDecimal x : xCoord) {</span>
<span class="nc bnc" id="L21" title="All 2 branches missed.">			for (BigDecimal y : yCoord) {</span>
<span class="nc" id="L22">				up.setCoordinate(new Coordinate(x, y));</span>
<span class="nc" id="L23">				up.add();</span>
<span class="nc" id="L24">			}</span>
<span class="nc" id="L25">		}</span>
<span class="nc" id="L26">	}</span>

<span class="fc" id="L28">	BiDimensionalMap() {</span>
<span class="fc" id="L29">	}</span>

	public final Collection&lt;T&gt; get(BigDecimal x, BigDecimal y) {
<span class="nc" id="L32">		Objects.requireNonNull(x, &quot;value of x cannot be null&quot;);</span>
<span class="nc" id="L33">		Objects.requireNonNull(y, &quot;value of y cannot be null&quot;);</span>
<span class="nc" id="L34">		return points.get(x).get(y);</span>
	}

	public final Collection&lt;T&gt; get(Coordinate coordinate) {
<span class="nc" id="L38">		Objects.requireNonNull(coordinate, &quot;Coordinate cannot be null&quot;);</span>
<span class="nc" id="L39">		return get(coordinate.x(), coordinate.y());</span>
	}

	public final Set&lt;BigDecimal&gt; xSet() {
<span class="nc" id="L43">		return points.keySet();</span>
	}

	public final Set&lt;BigDecimal&gt; ySet(BigDecimal x) {
<span class="nc" id="L47">		Objects.requireNonNull(x, &quot;x cannot be null&quot;);</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">		if (!points.containsKey(x)) {</span>
<span class="nc" id="L49">			throw new IllegalArgumentException(&quot;x is not in the map&quot;);</span>
		}
<span class="nc" id="L51">		return points.get(x).keySet();</span>
	}

	public final List&lt;Coordinate&gt; coordinateSet() {
<span class="nc" id="L55">		List&lt;Coordinate&gt; result = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L56">		Set&lt;BigDecimal&gt; xKeys = xSet();</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">		for (BigDecimal xKey : xKeys) {</span>
<span class="nc" id="L58">			Set&lt;BigDecimal&gt; yKeys = ySet(xKey);</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">			for (BigDecimal yKey : yKeys) {</span>
<span class="nc" id="L60">				Coordinate c = new Coordinate(xKey, yKey);</span>
<span class="nc" id="L61">				result.add(c);</span>
<span class="nc" id="L62">			}</span>
<span class="nc" id="L63">		}</span>
<span class="nc" id="L64">		result.sort(Coordinate::compareTo);</span>
<span class="nc" id="L65">		return result;</span>
	}

	@Override
	public String toString() {
<span class="nc" id="L70">		StringBuilder result = new StringBuilder();</span>
<span class="nc" id="L71">		Set&lt;BigDecimal&gt; xSet = this.xSet();</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">		for (BigDecimal x : xSet) {</span>
<span class="nc" id="L73">			Set&lt;BigDecimal&gt; ySet = this.ySet(x);</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">			for (BigDecimal y : ySet) {</span>
<span class="nc" id="L75">				result.append(&quot;(&quot;).append(x.toPlainString()).append(&quot;,&quot;).append(y.toPlainString()).append(&quot;):&quot;).append(points.get(x).get(y).toString()).append(&quot;\n&quot;);</span>
<span class="nc" id="L76">			}</span>
<span class="nc" id="L77">		}</span>
<span class="nc" id="L78">		return result.toString();</span>
	}

	// Helper method that returns the entire collection
	private Collection&lt;T&gt; fullCollection() {
<span class="nc" id="L83">		Collection&lt;T&gt; result = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L84">		Set&lt;BigDecimal&gt; xKeys = xSet();</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">		for (BigDecimal xKey : xKeys) {</span>
<span class="nc" id="L86">			Set&lt;BigDecimal&gt; yKeys = ySet(xKey);</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">			for (BigDecimal yKey : yKeys) {</span>
<span class="nc" id="L88">				result.addAll(points.get(xKey).get(yKey));</span>
<span class="nc" id="L89">			}</span>
<span class="nc" id="L90">		}</span>
<span class="nc" id="L91">		return result;</span>
	}

	public final long collectionSize() {
<span class="nc" id="L95">		Collection&lt;T&gt; fullC = fullCollection();</span>
<span class="nc" id="L96">		return fullC.size();</span>
	}

	public final long collectionSize(Predicate&lt;? super T&gt; filter) {
<span class="nc" id="L100">		Objects.requireNonNull(filter, &quot;filter cannot be null&quot;);</span>
<span class="nc" id="L101">		Collection&lt;T&gt; fullC = fullCollection();</span>
<span class="nc" id="L102">		return fullC.stream().filter(filter).count();</span>
	}

	public final Updater getUpdater() {
<span class="nc" id="L106">		return new Updater();</span>
	}

	private final void compareInner(BigDecimal x, BigDecimal y, Rectangle rectangle, Updater up) {
<span class="nc bnc" id="L110" title="All 2 branches missed.">		if (y.compareTo(rectangle.bottom()) &gt;= 0 &amp;&amp;</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">			x.compareTo(rectangle.top()) &lt; 0) {</span>
<span class="nc" id="L112">			up.setCoordinate(new Coordinate(x, y)).setValues(points.get(x).get(y)).add();</span>
		}
<span class="nc" id="L114">	}</span>

	public final BiDimensionalMap&lt;T&gt; slice(Rectangle rectangle) {
<span class="nc" id="L117">		Objects.requireNonNull(rectangle, &quot;rectangle cannot be null&quot;);</span>
<span class="nc" id="L118">		BiDimensionalMap&lt;T&gt; result = new BiDimensionalMap&lt;&gt;();</span>
<span class="nc" id="L119">		Updater up = result.getUpdater();</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">		for (BigDecimal x : xSet()) {</span>
<span class="nc bnc" id="L121" title="All 4 branches missed.">			if (x.compareTo(rectangle.left()) &gt;= 0 &amp;&amp; x.compareTo(rectangle.right()) &lt; 0) {</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">				for (BigDecimal y : ySet(x)) {</span>
<span class="nc" id="L123">					compareInner(x, y, rectangle, up);</span>
<span class="nc" id="L124">				}</span>
			}
<span class="nc" id="L126">		}</span>
<span class="nc" id="L127">		return result;</span>
	}

	public final void addEverywhere(T value) {
<span class="nc" id="L131">		Objects.requireNonNull(value, &quot;value cannot be null&quot;);</span>
<span class="nc" id="L132">		Updater up = new Updater();</span>
<span class="nc" id="L133">		up.addValue(value);</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">		for (BigDecimal x : xSet()) {</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">			for (BigDecimal y : ySet(x)) {</span>
<span class="nc" id="L136">				up.setCoordinate(new Coordinate(x, y));</span>
<span class="nc" id="L137">				up.add();</span>
<span class="nc" id="L138">			}</span>
<span class="nc" id="L139">		}</span>
<span class="nc" id="L140">	}</span>

<span class="nc" id="L142">	public final class Updater {</span>

<span class="nc" id="L144">		private BigDecimal x = BigDecimal.ZERO;</span>
<span class="nc" id="L145">		private BigDecimal y = BigDecimal.ZERO;</span>

<span class="nc" id="L147">		private final Supplier&lt;Collection&lt;T&gt;&gt; collectionFactory = HashSet::new;</span>

<span class="nc" id="L149">		private Collection&lt;T&gt; values = collectionFactory.get();</span>

		public final Updater setX(BigDecimal x) {
<span class="nc" id="L152">			Objects.requireNonNull(x, &quot;x cannot be null&quot;);</span>
<span class="nc" id="L153">			this.x = x;</span>
<span class="nc" id="L154">			return this;</span>
		}

		public final Updater setY(BigDecimal y) {
<span class="nc" id="L158">			Objects.requireNonNull(y, &quot;y cannot be null&quot;);</span>
<span class="nc" id="L159">			this.y = y;</span>
<span class="nc" id="L160">			return this;</span>
		}

		public final Updater setCoordinate(Coordinate coordinate) {
<span class="nc" id="L164">			Objects.requireNonNull(coordinate, &quot;Coordinate cannot be null&quot;);</span>
<span class="nc" id="L165">			coordinate.validate();</span>
<span class="nc" id="L166">			x = coordinate.x();</span>
<span class="nc" id="L167">			y = coordinate.y();</span>
<span class="nc" id="L168">			return this;</span>
		}


		public final Updater addValue(T value) {
<span class="nc" id="L173">			Objects.requireNonNull(value, &quot;value cannot be null&quot;);</span>
<span class="nc" id="L174">			values.add(value);</span>
<span class="nc" id="L175">			return this;</span>
		}

		public final Updater setValues(Collection&lt;T&gt; values) {
<span class="nc" id="L179">			Objects.requireNonNull(values, &quot;new values cannot be null&quot;);</span>
<span class="nc" id="L180">			this.values = values;</span>
<span class="nc" id="L181">			return this;</span>
		}

		public final Collection&lt;T&gt; set() {
<span class="nc bnc" id="L185" title="All 2 branches missed.">			if (points.containsKey(x)) {</span>
<span class="nc" id="L186">				SortedMap&lt;BigDecimal, Collection&lt;T&gt;&gt; temp = points.get(x);</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">				if (temp.containsKey(y)) {</span>
<span class="nc" id="L188">					temp.put(y, values);</span>
<span class="nc" id="L189">					points.put(x, temp);</span>
<span class="nc" id="L190">					return temp.get(y);</span>
				}
			}

<span class="nc" id="L194">			return null;</span>
		}

		public final boolean add() {
<span class="nc" id="L198">			boolean flag = false;</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">			if (points.containsKey(x)) {</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">				if (points.get(x).containsKey(y)) {</span>
<span class="nc" id="L201">					Collection&lt;T&gt; prevValues = points.get(x).get(y);</span>
<span class="nc" id="L202">					points.get(x).get(y).addAll(values);</span>
<span class="nc" id="L203">					Collection&lt;T&gt; newValues = points.get(x).get(y);</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">					flag = !newValues.equals(prevValues);</span>
<span class="nc" id="L205">				} else {</span>
<span class="nc" id="L206">					points.get(x).put(y, collectionFactory.get());</span>
<span class="nc" id="L207">					points.get(x).get(y).addAll(values);</span>
				}
			} else {
<span class="nc" id="L210">				SortedMap&lt;BigDecimal, Collection&lt;T&gt;&gt; s = new TreeMap&lt;&gt;();</span>
<span class="nc" id="L211">				Collection&lt;T&gt; newValues = collectionFactory.get();</span>
<span class="nc" id="L212">				newValues.addAll(values);</span>
<span class="nc" id="L213">				s.put(y, newValues);</span>
<span class="nc" id="L214">				points.put(x, s);</span>
			}
<span class="nc" id="L216">			return flag;</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>